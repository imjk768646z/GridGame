"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DefaultResetOptions=exports.FiniteStateMachine=exports.TransitionFunction=exports.Transitions=void 0;class Transitions{constructor(t){this.fsm=t}to(...t){this.toStates=t,this.fsm.addTransitions(this)}toAny(t){var i=[];for(var s in t)t.hasOwnProperty(s)&&i.push(t[s]);this.toStates=i,this.fsm.addTransitions(this)}}exports.Transitions=Transitions;class TransitionFunction{constructor(t,i,s){this.fsm=t,this.from=i,this.to=s}}exports.TransitionFunction=TransitionFunction;class FiniteStateMachine{constructor(t,i=!1){this._transitionFunctions=[],this._onCallbacks={},this._exitCallbacks={},this._enterCallbacks={},this._invalidTransitionCallback=null,this.currentState=t,this._startState=t,this._allowImplicitSelfTransition=i}addTransitions(t){t.fromStates.forEach((i=>{t.toStates.forEach((t=>{this._canGo(i,t)||this._transitionFunctions.push(new TransitionFunction(this,i,t))}))}))}on(t,i){var s=t.toString();return this._onCallbacks[s]||(this._onCallbacks[s]=[]),this._onCallbacks[s].push(i),this}onEnter(t,i){var s=t.toString();return this._enterCallbacks[s]||(this._enterCallbacks[s]=[]),this._enterCallbacks[s].push(i),this}onExit(t,i){var s=t.toString();return this._exitCallbacks[s]||(this._exitCallbacks[s]=[]),this._exitCallbacks[s].push(i),this}onInvalidTransition(t){return this._invalidTransitionCallback||(this._invalidTransitionCallback=t),this}from(...t){var i=new Transitions(this);return i.fromStates=t,i}fromAny(t){var i=[];for(var s in t)t.hasOwnProperty(s)&&i.push(t[s]);var n=new Transitions(this);return n.fromStates=i,n}_validTransition(t,i){return this._transitionFunctions.some((s=>s.from===t&&s.to===i))}_canGo(t,i){return this._allowImplicitSelfTransition&&t===i||this._validTransition(t,i)}canGo(t){return this._canGo(this.currentState,t)}go(t,i){if(this.canGo(t))this._transitionTo(t,i);else if(!this._invalidTransitionCallback||!this._invalidTransitionCallback(this.currentState,t))throw new Error("Error no transition function exists from state "+this.currentState.toString()+" to "+t.toString())}onTransition(t,i){}reset(t){t=Object.assign(Object.assign({},exports.DefaultResetOptions),t||{}),this.currentState=this._startState,t.runCallbacks&&this._onCallbacks[this.currentState.toString()].forEach((t=>{t.call(this,null,null)}))}is(t){return this.currentState===t}_transitionTo(t,i){this._exitCallbacks[this.currentState.toString()]||(this._exitCallbacks[this.currentState.toString()]=[]),this._enterCallbacks[t.toString()]||(this._enterCallbacks[t.toString()]=[]),this._onCallbacks[t.toString()]||(this._onCallbacks[t.toString()]=[]);var s=this._exitCallbacks[this.currentState.toString()].reduce(((i,s)=>i&&s.call(this,t)),!0),n=this._enterCallbacks[t.toString()].reduce(((t,s)=>t&&s.call(this,this.currentState,i)),!0);if(s&&n){var a=this.currentState;this.currentState=t,this._onCallbacks[this.currentState.toString()].forEach((t=>{t.call(this,a,i)})),this.onTransition(a,t)}}}exports.FiniteStateMachine=FiniteStateMachine,exports.DefaultResetOptions={runCallbacks:!1};